let mobMenu=document.querySelector(".header-mobile-menu");function openModal(e){let t=document.querySelector(".modal.open");t||mobMenu.classList.contains("menu--active")||disableScroll(),t&&t.classList.remove("open"),e.classList.add("open")}function closeModal(e){e.classList.remove("open"),setTimeout((()=>{mobMenu.classList.contains("menu--active")||enableScroll()}),400)}const stories=document.querySelector(".stories"),story=document.querySelectorAll(".item-story");let stroiesSwiper;stories&&story.length>0&&(stories.querySelector(".swiper")&&(stroiesSwiper=new Swiper(stories.querySelector(".swiper"),{slidesPerView:2,spaceBetween:15,observer:!0,observeParents:!0,watchSlidesProgress:!0,breakpoints:{1450:{slidesPerView:5,spaceBetween:20},1250:{slidesPerView:4,spaceBetween:20},575:{slidesPerView:3,spaceBetween:20}},speed:800})),story.forEach((e=>{let t=e.querySelectorAll(".item-story__story").length;if(+e.getAttribute("data-watched")==t?(e.classList.add("seen"),e.setAttribute("data-last",0)):e.setAttribute("data-last",+e.getAttribute("data-watched")),t>1){let r=(e.querySelector(".item-story__bg-path").getTotalLength()-20*t)/t;e.querySelector(".item-story__bg-path").style.strokeDasharray=`${r} 20`}})),stories.addEventListener("click",(e=>{document.querySelectorAll(".item-story").forEach(((t,r)=>{if(t.contains(e.target)){let i,n,a,d=r,c=+t.getAttribute("data-last"),y=!1;document.querySelector(".footer").insertAdjacentHTML("afterend",`\n                <div class="modal story-modal">\n                    <div class="container modal__top">\n                        <button class="btn-reset modal__close">\n                            <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 42 42" fill="none">\n                                <line x1="10.3935" y1="31.2531" x2="31.2531" y2="10.3935" stroke-width="1.5"></line>\n                                <line x1="31.2529" y1="31.6065" x2="10.3932" y2="10.7469" stroke-width="1.5"></line>\n                            </svg>\n                        </button>\n                    </div>\n                    <div class="modal__overlay">\n                        <div class="modal__content">\n                            <div class="modal__inner">\n                                <div class="swiper">\n                                    <div class="swiper-wrapper">\n                                        ${Array.from(story).map((e=>`<div class="swiper-slide">\n                                            <div class="story-modal__item">\n                                                <div class="story-modal__progress">\n                                                    ${Array.from(e.querySelectorAll(".item-story__story")).map((e=>'<div class="story-modal__progress-bar">\n                                                        <span></span>\n                                                    </div>')).join("")}\n                                                </div>\n                                                <div class="media-cover"></div>\n                                                <div class="story-modal__content"></div>\n                                                <form class="form story-form">\n                                                    <textarea placeholder="Сообщение..." name="message"></textarea>\n                                                    <button type="submit" class="btn-reset story-form__btn">\n                                                        <svg xmlns="http://www.w3.org/2000/svg" id="send" viewBox="0 0 18 18">\n                                                        <path d="M12.1048 2.2193L5.33234 4.4693C0.779844 5.9918 0.779844 8.4743 5.33234 9.9893L7.34234 10.6568L8.00984 12.6668C9.52484 17.2193 12.0148 17.2193 13.5298 12.6668L15.7873 5.9018C16.7923 2.8643 15.1423 1.2068 12.1048 2.2193ZM12.3448 6.2543L9.49484 9.1193C9.38234 9.2318 9.23984 9.2843 9.09734 9.2843C8.95484 9.2843 8.81234 9.2318 8.69984 9.1193C8.48234 8.9018 8.48234 8.5418 8.69984 8.3243L11.5498 5.4593C11.7673 5.2418 12.1273 5.2418 12.3448 5.4593C12.5623 5.6768 12.5623 6.0368 12.3448 6.2543Z"/>\n                                                        </svg>\n                                                    </button>\n                                                </form>\n                                            </div>\n                                        </div>`)).join("")}\n                                    </div>\n                                </div>\n                                <button type="button" class="btn-reset nav-btn nav-btn--prev">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" fill="none">\n                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M29.73 -0.00260162L0.216305 29.5111L29.73 59.0248L33.2952 55.4596L9.86778 32.0321H60V26.9901H9.86778L33.2952 3.56264L29.73 -0.00260162Z" fill="white"/>\n                                    </svg>\n                                </button>\n                                <button type="button" class="btn-reset nav-btn nav-btn--next">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" fill="none">\n                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M30.27 -0.00260162L59.7837 29.5111L30.27 59.0248L26.7048 55.4596L50.1322 32.0321H0V26.9901H50.1322L26.7048 3.56264L30.27 -0.00260162Z" fill="white"/>\n                                    </svg>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                `);const u=document.querySelector(".story-modal");let m=new Swiper(".story-modal .swiper",{slidesPerView:1,observer:!0,observeParents:!0,initialSlide:d,navigation:{prevEl:".story-modal .nav-btn--prev",nextEl:".story-modal .nav-btn--next"},speed:500});function s(){if(u){let e=u.querySelector(".modal__content").clientHeight/1.77;e>u.querySelector(".modal__content").clientWidth?(e=u.querySelector(".modal__content").clientWidth,u.querySelector(".swiper").style.width=e+"px",u.querySelector(".swiper").style.height=1.77*e+"px"):(u.querySelector(".swiper").style.width=e+"px",u.querySelector(".swiper").style.height=u.querySelector(".modal__content").clientHeight+"px")}}function o(){i=story[d].querySelectorAll(".item-story__story").length,a=u.querySelectorAll(".swiper-slide")[d];let e=story[d].querySelectorAll(".item-story__story")[c].cloneNode(!0),t=story[d].querySelectorAll(".item-story__mod-item")[c].querySelector(".item-story__mod-content");function r(e){e.querySelector("textarea").value.length>0?e.classList.add("btn-show"):(e.querySelector("textarea").style.height="",e.classList.remove("btn-show"))}a.querySelector(".story-modal__content").innerHTML=t?t.innerHTML:"",a.querySelector(".media-cover").innerHTML=story[d].querySelectorAll(".item-story__mod-item")[c].querySelector(".item-story__mod-src").innerHTML,a.querySelectorAll(".story-modal__progress-bar").forEach(((e,t)=>{t<c&&(e.querySelector("span").style.transitionDuration="0s",e.classList.add("seen"))})),a.querySelectorAll("[data-src]").forEach((e=>{e.setAttribute("src",e.getAttribute("data-src")),e.removeAttribute("data-src")})),a.querySelector("[data-srcset]")&&a.querySelectorAll("[data-srcset]").forEach((e=>{e.setAttribute("srcset",e.getAttribute("data-srcset")),e.removeAttribute("data-srcset")})),"video"==e.tagName.toLowerCase()?a.querySelector(".media-cover video").addEventListener("loadedmetadata",(e=>{let t=a.querySelector(".media-cover video").duration;a.querySelectorAll(".story-modal__progress-bar span")[c].style.transitionDuration=t+"s",a.querySelector(".media-cover video").play(),a.querySelector(".media-cover video").setAttribute("autoplay",""),a.querySelectorAll(".story-modal__progress-bar")[c].classList.add("seen"),n=setTimeout(l,1e3*t)})):(a.querySelectorAll(".story-modal__progress-bar span")[c].style.transitionDuration="15s",a.querySelectorAll(".story-modal__progress-bar")[c].classList.add("seen"),n=setTimeout(l,15e3));let s=a.querySelector(".story-form");r(s),s.querySelector("textarea").addEventListener("input",(()=>{let e=s.querySelector("textarea");e.style.height="",e.style.height=e.style.height=e.scrollHeight+"px",r(s)})),s.addEventListener("submit",(e=>{e.preventDefault(),s.querySelector("textarea").value="",s.querySelector("textarea").style.height="",r(s)}))}function l(){if(y=!0,c<i-1)c++,story[d].setAttribute("data-last",c),story[d].setAttribute("data-watched",c),o();else{if(story[d].setAttribute("data-watched",c+1),story[d].setAttribute("data-last",0),!story[d].classList.contains("seen")&&(story[d].classList.add("seen"),stroiesSwiper&&(stroiesSwiper.appendSlide(`<div class="swiper-slide">${story[d].parentNode.innerHTML}</div>`),stroiesSwiper.removeSlide(d)),document.querySelector(".stories-p__items"))){let e=story[d].cloneNode(!0);document.querySelector(".stories-p__items").append(e),story[d].remove()}a.querySelectorAll(".story-modal__progress-bar").forEach((e=>{e.querySelector("span").style.transitionDuration="0",e.classList.remove("seen")})),d<story.length-1?(d++,m.slideTo(d)):(clearTimeout(n),closeModal(u),setTimeout((()=>{u.remove()}),400))}y=!1}m.on("slideChange",(e=>{d=e.realIndex,clearTimeout(n),a&&(a.querySelectorAll(".story-modal__progress-bar span")[c].style.transitionDuration="0s",a.querySelectorAll(".story-modal__progress-bar")[c].classList.remove("seen")),c=+story[d].getAttribute("data-last"),o()})),s(),window.addEventListener("resize",(()=>s())),openModal(u),u.querySelectorAll(".media-cover").forEach((e=>{e.addEventListener("click",(e=>{window.innerWidth/2<e.x?y||(clearTimeout(n),a&&(a.querySelectorAll(".story-modal__progress-bar span")[c].style.transition="none",setTimeout((()=>{a.querySelectorAll(".story-modal__progress-bar span")[c].style.transition=null}),0)),l()):y||(clearTimeout(n),story[d].setAttribute("data-last",0==c?0:c-1),a&&a.querySelectorAll(".story-modal__progress-bar").forEach(((e,t)=>{t>=c-1&&(e.querySelector("span").style.transition="none",e.classList.remove("seen"),setTimeout((()=>{e.querySelector("span").style.transition=null}),0))})),0==c?0==d?(clearTimeout(n),closeModal(u),setTimeout((()=>{u.remove()}),400)):(d--,m.slideTo(d)):(c--,setTimeout((()=>{o()}),0)))}))})),o(),u.querySelector(".modal__close").addEventListener("click",(e=>{clearTimeout(n),closeModal(u),setTimeout((()=>{u.remove()}),400)}))}}))})));